# Generate Dependabot Config
# ==========================
# Reusable workflow to generate a dependabot config from predefined templates.
# Mainly using [Generate Dependabot Glob Action](https://github.com/marketplace/actions/generate-dependabot-glob), to generate a dependabot config from a glob pattern.
# Workaround for missing official support of glob directories [https://github.com/dependabot/dependabot-core/issues/2178](https://github.com/dependabot/dependabot-core/issues/2178)

on:
  workflow_call:
    secrets:
      github-token:
        description: 'GitHub token for creating and merging pull request (permissions contents: write and pull-requests: write). Can be passed in using "secrets.GITHUB_TOKEN". See https://github.com/hoverkraft-tech/ci-github-common/blob/main/actions/create-and-merge-pull-request'
        required: true

jobs:
  main:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Generate Dependabot Glob
        uses: Makeshift/generate-dependabot-glob-action@v1.3.3

      - uses: hoverkraft-tech/ci-github-common/actions/create-and-merge-pull-request@main
        with:
          github-token: ${{ secrets.github-token }}
          branch: chore/dependabot-config
          title: "chore: update dependabot config"
          body: Update dependabot config for glob directories
