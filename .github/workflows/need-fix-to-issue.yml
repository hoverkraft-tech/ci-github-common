# Reusable workflow to convert comments requiring fixes (todo, FIXME) to issues.
# Mainly using [Todo to Issue Action](https://github.com/alstr/todo-to-issue-action), with some opinionated defaults.

name: "Need fix to Issue"
on:
  push:
    branches:
      - "main"
  workflow_dispatch:
    #checkov:skip=CKV_GHA_7: required
    inputs:
      manual-commit-ref:
        description: "The SHA of the commit to get the diff for."
        required: true
      manual-base-ref:
        description: "By default, the commit entered above is compared to the one directly before it; to go back further, enter an earlier SHA here."
        required: false
  workflow_call:
    inputs:
      runs-on:
        description: |
          JSON array of runner(s) to use.
          See https://docs.github.com/en/actions/using-jobs/choosing-the-runner-for-a-job.
        type: string
        default: '["ubuntu-latest"]'
        required: false
      manual-commit-ref:
        description: "The SHA of the commit to get the diff for."
        type: string
        required: false
      manual-base-ref:
        description: "By default, the commit entered above is compared to the one directly before it; to go back further, enter an earlier SHA here."
        type: string
        required: false

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

permissions: {}

jobs:
  need-fix-to-issue:
    name: "üîç Convert TODO/FIXME to Issue"
    runs-on: ${{ inputs.runs-on && fromJson(inputs.runs-on) || 'ubuntu-latest' }}
    permissions:
      contents: read
      issues: write
    steps:
      - uses: "actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd" # v6.0.2
        with:
          persist-credentials: false

      - name: "TODO to Issue"
        uses: "alstr/todo-to-issue-action@c45b007d85c8edf3365b139a9d4c65793e7c674f" # v5.1.13
        with:
          IDENTIFIERS: |
            [
                {"name": "TODO:", "labels": ["help wanted"]},
                {"name": "FIXME:", "labels": ["bug"]}
            ]
        env:
          MANUAL_COMMIT_REF: ${{ inputs.manual-commit-ref }}
          MANUAL_BASE_REF: ${{ inputs.manual-base-ref }}
